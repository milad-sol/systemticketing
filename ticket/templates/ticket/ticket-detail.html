{% extends 'main.html' %}


{% block main %}

    <!-- Ticket Detail Content -->
    <div class="content">
        <div class="ticket-detail-card">
            <h2>Ticket Detail</h2>

            <!-- Ticket Information -->
            <div class="ticket-info">
                <p><strong>Ticket ID:</strong> # {{ ticket.id }}</p>
                <p><strong>Subject:</strong> {{ ticket.subject }}</p>
                <p><strong>Status:</strong> {{ ticket.status }}</p>
                <p><strong>Submitted On:</strong> {{ ticket.created_at |timesince }} ago</p>
            </div>

            <!-- User Question -->
            <div class="ticket-section">
                <h4>User Question</h4>
                <p>
                    {{ ticket.description }}
                </p>
                <p><em>Attached File : <a href="{{ ticket.file.url }}">link</a></em></p>

            </div>

            <!-- Admin Answer -->
            {% for message in all_ticket %}
                {% if message.is_admin_response %}
                    <div class="ticket-section">
                        <h4>Admin Response</h4>
                        <p>
                            {{ message.content }}
                        </p>
                        {% if  message.file %}
                            <p><em>Attached File : <a href="{{ message.file.url }}">link</a></em></p>
                        {% endif %}
                        <p><em>Responded on: {{ message.created_at|timesince }} ago </em></p>
                    </div>

                {% elif not message.is_admin_response %}
                    <div class="ticket-section">
                        <h4>User Question</h4>
                        <p>
                            {{ ticket.description }}
                        </p>
                        <p><em>Attached File : <a href="{{ ticket.file.url }}">link</a></em></p>

                    </div>
                {% endif %}




            {% endfor %}


            <!-- Follow-Up Response Form -->
            <div class="response-form">
                <h4>Add a Follow-Up Response</h4>
                <form action="/ticket/001/response" method="POST" enctype="multipart/form-data">
                    <div class="form-group mb-4">
                        <label for="followUpResponse">Your Response</label>
                        <textarea class="form-control" id="followUpResponse" name="response"
                                  placeholder="Add additional comments or questions..." required></textarea>
                    </div>
                    <div class="form-group mb-4">
                        <label for="attachment">Attach File</label>
                        <input type="file" class="custom-file-input" id="attachment" name="attachment">
                    </div>
                    <div class="button-group">
                        <button type="submit" class="btn btn-primary">Submit Response</button>
                        <a href="ticket-detail.html" class="btn btn-secondary">Cancel</a>
                    </div>
                </form>
            </div>

            <div class="text-center mt-4">
                <div class="button-group">
                    <a href="profile.html" class="btn btn-primary">Back to Profile</a>
                    <button type="button" class="btn btn-danger"
                            onclick="if(confirm('Are you sure you want to close this ticket?')) { window.location.href='/ticket/001/close'; }">
                        Close Ticket
                    </button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

